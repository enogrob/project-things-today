## Crafted (c) 2013~2016 by ZoatWorks Software LTDA.
## Prepared : Roberto Nogueira
## File     : .todayrc
## Version  : PA22
## Date     : 2016-12-10
## Project  : project-things-today
## Reference: bash
##
## Purpose  : Develop a system in order to help TODAY management directory
##            for projects.

THINGS=$HOME/THINGS_HOME
TODO_DIR=$HOME/.todo
TODOTXT=$HOME/.todo/todo.sh

TODAY_LINK=$HOME/Today
PROJECTS_LINK=$HOME/Projects

AREAS=$THINGS/Areas
PROJECTS=$THINGS/Projects
RESOURCES=$THINGS/Resources
INBOX=$THINGS/Inbox
LOGBOOK=$THINGS/Logbook
SCHEDULED=$THINGS/Scheduled
SOMEDAY=$THINGS/Someday
TODAY=$THINGS/Today

CLOUD=$HOME/Google\ Drive/Things
LOCAL=$HOME/Things

alias tdy='things today'
alias tdyl='things today list'
alias tdyi='things today start'
alias tdye='things today stop'
alias tdyia='things today startall'
alias tdyea='things today stopall'
alias tdyj='things today jump'
alias tdya='things today archive'

alias tdp='things projects'
alias tdpl='things projects list'
alias tdpn='things projects new'
alias tdpj='things projects jump'

alias tda='things areas'
alias tdal='things areas list'
alias tdai='things areas start'
alias tdae='things areas stop'

alias tdl='things logbook'
alias tdll='things logbook list'
alias tdli='things logbook start'
alias tdle='things logbook stop'

alias tdsd='things someday'
alias tdsdl='things someday list'
alias tdsdi='things someday start'
alias tdsde='things someday stop'

alias tdc='things cloud'
alias tdci='things cloud start'
alias tdce='things cloud stop'
alias tdcc='things cloud copy'

alias tdi='things inbox'
alias tdil='things inbox list'

alias tdg='things git'
alias tdgi='things git start'
alias tdge='things git stop'

alias tds='things scheduled'
alias tdsl='things scheduled list'
alias tdss='things scheduled summary'
alias tdsi='things scheduled start'
alias tdse='things scheduled stop'
alias tdsia='things scheduled startall'
alias tdsea='things scheduled stopall'

print(){
    if [ $# -eq 0 ]; then
        echo -e ""
    elif [ $# -eq 1 ]; then
        echo -e "\033[1;39m$1 \033[0m"
    elif [ $# -eq 2 ]; then
        case $2 in
            red)
                echo -e "\033[31m$1 \033[0m"
                ;;
            green)
                echo -e "\033[32m$1 \033[0m"
                ;;
            yellow)
                echo -e "\033[33m$1 \033[0m"
                ;; 
            blue)
                echo -e "\033[34m$1 \033[0m"
                ;; 
            magenta)
                echo -e "\033[35m$1 \033[0m"
                ;; 
            cyan)
                echo -e "\033[36m$1 \033[0m"
                ;; 
            lightred)
                echo -e "\033[1;91m$1 \033[0m"
                ;;
            lightgreen)
                echo -e "\033[1;92m$1 \033[0m"
                ;;
            lightyellow)
                echo -e "\033[1;93m$1 \033[0m"
                ;; 
            lightblue)
                echo -e "\033[1;94m$1 \033[0m"
                ;; 
            lightmagenta)
                echo -e "\033[1;95m$1 \033[0m"
                ;; 
            lightcyan)
                echo -e "\033[1;96m$1 \033[0m"
                ;;            
            *)
                echo -e "\033[1;39m$1 \033[0m"
                ;;   
        esac        
    else
        printerr "=> Error: Bad number of arguments."
        print
        return 1
    fi
}

printerr(){
    echo -e "\033[31m$1 \033[0m"
}

is_Things() {
if [ "$1" == "`readlink $THINGS`" ]
  then
    # 0 = true
    return 0 
  else
    # 1 = false
    return 1
  fi
}

replace_icon(){
    droplet=$1
    icon=$2
    if [[ $icon =~ ^https?:// ]]; then
        curl -sLo /tmp/icon $icon
        icon=/tmp/icon
    fi
    rm -rf $droplet$'/Icon\r'
    sips -i $icon >/dev/null
    DeRez -only icns $icon > /tmp/icns.rsrc
    Rez -append /tmp/icns.rsrc -o $droplet$'/Icon\r'
    SetFile -a C $droplet
    SetFile -a V $droplet$'/Icon\r'
}

function teste10(){
    s1="ebook\|x"
    case $1 in
        $s1) echo "Yes"
        ;;
        *) echo "No"
        ;;
    esac
}

function task_name(){
    shopt -s extglob         
    TAGSPROJECTS='+(ebook|tutorialspoint|sololearn|udemy|project|hackerrank|codewar|tutorial|specialization|job|chrome|coursera|linkedin)'
    TAGSCONTEXTS='+(java|cpp|ruby|erlang|elixir|javascript|html|css|nodejs|rails|phoenix|bluemix|bash|r|vuejs|elm)'
    
    local TASKNAME=`basename $1`
    local TASKTAGS=(`tag -lN $1 | sed 's/,/ /g'`)
    
    for n in "${TASKTAGS[@]}"
    do
        case $n in
            $TAGSPROJECTS)
                TASKNAME=$TASKNAME" +"$n
                ;;
        esac
    done
    for n in "${TASKTAGS[@]}"
    do
        case $n in
            $TAGSCONTEXTS)
                TASKNAME=$TASKNAME" @"$n
                ;;
        esac
    done    
    echo $TASKNAME
}

function tag_contexts(){
    shopt -s extglob         
    local TAGSCONTEXTS='+(java|cpp|ruby|erlang|elixir|javascript|html|css|nodejs|rails|phoenix|bluemix|bash|r|vuejs|elm)'
    
    local PROJECTNAME=`basename $1`
    local PROJECTTAGS=(`echo $PROJECTNAME | sed 's/-/ /g'`)
    
    for n in "${PROJECTTAGS[@]}"
    do
        case $n in
            $TAGSCONTEXTS)
            tag -a $n "$1"
            ;;
        esac
    done 
    return 0
}

function scheduled(){
    if [ $# -eq 0 ]; then
        local DAYOFWEEK=$(echo $(date +"%a") | awk '{print tolower($0)}') 
        pushd . &>/dev/null  
        cd "$PROJECTS"      
        tag -m scheduled > $PROJECTS/PROJECTS-SCHEDULED.txt
        print "mon tue wed thu fri sat sun" green                     
        while read line; do         
            local PROJTAGS=`tag -lN $line | sed 's/,/ /g'`
            local SCHEDULED=""
            if [[ "$PROJTAGS" =~ "mon" ]];  then
                SCHEDULED=" x |";
            else
                SCHEDULED="   |";
            fi
            if [[ "$PROJTAGS" =~ "tue" ]];  then
                SCHEDULED=$SCHEDULED" x |"; 
            else
                SCHEDULED=$SCHEDULED"   |"; 
            fi                             
            if [[ "$PROJTAGS" =~ "wed" ]];  then
                SCHEDULED=$SCHEDULED" x |"; 
            else
                SCHEDULED=$SCHEDULED"   |"; 
            fi                                            
            if [[ "$PROJTAGS" =~ "thu" ]];  then
                SCHEDULED=$SCHEDULED" x |"; 
            else
                SCHEDULED=$SCHEDULED"   |"; 
            fi                                            
            if [[ "$PROJTAGS" =~ "fri" ]];  then
                SCHEDULED=$SCHEDULED" x |"; 
            else
                SCHEDULED=$SCHEDULED"   |"; 
            fi                                            
            if [[ "$PROJTAGS" =~ "sat" ]]; then
                SCHEDULED=$SCHEDULED" x |"; 
            else
                SCHEDULED=$SCHEDULED"   |"; 
            fi                                           
            if [[ "$PROJTAGS" =~ "sun" ]];  then
                SCHEDULED=$SCHEDULED" x |"; 
            else
                SCHEDULED=$SCHEDULED"   |"; 
            fi                                                            
            if [[ "$PROJTAGS" =~ $DAYOFWEEK ]];  then
                print "$SCHEDULED $line"
            else 
                print "$SCHEDULED $line" cyan
            fi
        done < $PROJECTS/PROJECTS-SCHEDULED.txt
    else
        local DAYOFWEEK=$1
        pushd . &>/dev/null  
        cd "$PROJECTS" 
        DAYOFWEEK=(`echo $DAYOFWEEK | sed 's/,/ /g'`)
        
        for m in "${DAYOFWEEK[@]}"
        do
          case $m in
              mon|tue|wed|thu|fri|sat|sun|scheduled)
                  tag -m "${m}" >> $PROJECTS/PROJECTS-SCHEDULED.txt 
                  ;;
              *)  tag -m "${m},scheduled" >> $PROJECTS/PROJECTS-SCHEDULED.txt 
                  ;;
          esac 
        done
        
        cat $PROJECTS/PROJECTS-SCHEDULED.txt | sort | uniq > $PROJECTS/PROJECTS-SCHEDULED_TEMP.txt
        rm -f $PROJECTS/PROJECTS-SCHEDULED.txt
        mv $PROJECTS/PROJECTS-SCHEDULED_TEMP.txt $PROJECTS/PROJECTS-SCHEDULED.txt 
        
        print "mon tue wed thu fri sat sun" green                     
        while read line; do         
            local PROJTAGS=`tag -lN $line | sed 's/,/ /g'`
            local SCHEDULED=""
            if [[ "$PROJTAGS" =~ "mon" ]];  then
                SCHEDULED=" x |";
            else
                SCHEDULED="   |";
            fi
            if [[ "$PROJTAGS" =~ "tue" ]];  then
                SCHEDULED=$SCHEDULED" x |"; 
            else
                SCHEDULED=$SCHEDULED"   |"; 
            fi                             
            if [[ "$PROJTAGS" =~ "wed" ]];  then
                SCHEDULED=$SCHEDULED" x |"; 
            else
                SCHEDULED=$SCHEDULED"   |"; 
            fi                                            
            if [[ "$PROJTAGS" =~ "thu" ]];  then
                SCHEDULED=$SCHEDULED" x |"; 
            else
                SCHEDULED=$SCHEDULED"   |"; 
            fi                                            
            if [[ "$PROJTAGS" =~ "fri" ]];  then
                SCHEDULED=$SCHEDULED" x |"; 
            else
                SCHEDULED=$SCHEDULED"   |"; 
            fi                                            
            if [[ "$PROJTAGS" =~ "sat" ]]; then
                SCHEDULED=$SCHEDULED" x |"; 
            else
                SCHEDULED=$SCHEDULED"   |"; 
            fi                                           
            if [[ "$PROJTAGS" =~ "sun" ]];  then
                SCHEDULED=$SCHEDULED" x |"; 
            else
                SCHEDULED=$SCHEDULED"   |"; 
            fi             
            if [[ "$PROJTAGS" =~ $DAYOFWEEK ]];  then
                print "$SCHEDULED $line"
            else 
                print "$SCHEDULED $line" cyan
            fi
        done < $PROJECTS/PROJECTS-SCHEDULED.txt        
    fi
    rm -f $PROJECTS/PROJECTS-SCHEDULED.txt
    popd &>/dev/null
}

function things() {
    shopt -s extglob         
    TAGSPROJECTS='+(ebook|tutorialspoint|sololearn|udemy|project|hackerrank|codewar|tutorial|specialization|job|chrome|coursera|linkedin)'
    
    case $1 in
        areas)
            shift
            case $1 in
                list)
                    tree -L 1 -Cd -l "$AREAS"
                    open -g "$AREAS"
                    ;;

                start)
                    shift
                    if [ $# -eq 1 ]; then
                        PROJECT=`basename "$PWD"`
                        AREA=$1
                    else
                        printerr "==> Error: Bad number of arguments."
                        print
                        return 1
                    fi
                    case $AREA in
                         codewars|course|coursera|catabases|datascience|devops|ebook|iot|job|krishnamurti|phoenix|\
                         rails|ruby|specialization|suspended|tutorial|udemy|webdev|tutorialspoint|sololearn)
                         ;;
                         *)  
                         printerr "==> Error: Bad project type."
                         print
                         return 1
                         ;;
                    esac
                    PROJECTDIR=`find "$PROJECTS" -name $PROJECT`
                    if [ -n "$PROJECTDIR" ]; then
                        if [ ! -L "$AREAS/$AREA/$($TODOTXT -@+ list $PROJECT | head -1)" ]; then 
                            ln -sf "$PWD" "$AREAS/$AREA/$($TODOTXT -@+ list $PROJECT | head -1)"; 
                        fi
                        if [ ! -L "$TODAY/$AREA" ]; then ln -sf "$AREAS/$AREA" "$TODAY/$AREA" ; fi  
                    fi
                    open -g "$TODAY" 
                    ;;
                    
                stop)
                    PROJECT=`basename "$PWD"`
                    AREADIR=`find "$AREAS" -name $PROJECT`
                    if [ -n "$AREADIR" ]; then
                       AREADIRNAME=`dirname "$AREADIR"`
                       AREA=`basename "$AREADIRNAME"`
                       if [ -L "$AREAS/$AREA/$($TODOTXT -@+ list $PROJECT | head -1)" ]; then 
                           rm -f "$AREAS/$AREA/$($TODOTXT -@+ list $PROJECT | head -1)"; 
                       fi
                       if [ -L "$TODAY/$AREA" ]; then
                          files=("$AREAS/$AREA/*")
                          if [ ${#files[@]} -lt 2 ]; then rm -f "$TODAY/$AREA"; fi
                       fi 
                    fi
                    cd "$TODAY"
                    open -g . 
                    ;;
                    
                *)
                    cd "$AREAS"
                    open -g .
                    ;;
            esac
            ;;
            
        projects)
            shift
            case $1 in
                list)
                    shift
                    if [ $# -eq 0 ]; then
                        tree -L 1 -Cd -l "$PROJECTS"
                        open -g "$PROJECTS"
                    elif [ $# -eq 1 ]; then                        
                        local PROJTAGS=$1
                        pushd . &>/dev/null  
                        cd "$PROJECTS" 
                        PROJTAGS=(`echo $PROJTAGS | sed 's/,/ /g'`)
        
                        for m in "${PROJTAGS[@]}"
                        do
                            tag -m "${m}" >> $PROJECTS/PROJECTS.txt 
                        done
        
                        cat $PROJECTS/PROJECTS.txt | sort | uniq > $PROJECTS/PROJECTS_TEMP.txt
                        rm -f $PROJECTS/PROJECTS.txt
                        mv $PROJECTS/PROJECTS_TEMP.txt $PROJECTS/PROJECTS.txt 
        
                        printf "==> Projects with tag(s): "
                        print $1 green                     
                        while read line; do         
                                print $line cyan    
                        done < $PROJECTS/PROJECTS.txt        
                        rm -f $PROJECTS/PROJECTS.txt
                        popd &>/dev/null
                    else
                        printerr "==> Error: Bad number of arguments."
                        print
                        return 1
                    fi
                    ;;
                    
                new)
                    shift
                    
                    if [ $# -eq 0 ]; then
                        printerr "==> Error: Bad number of arguments."
                        print
                        return 1
                    elif [ $# -eq 1 ]; then
                        PROJECT=$1
                        PROJECT_TYPE=project
                    elif [ $# -eq 2 ]; then
                        PROJECT=$1
                        PROJECT_TYPE=$2
                        case $PROJECT_TYPE in
                            $TAGSPROJECTS)  
                                ;;
                                *)  
                                printerr "==> Error: Bad project type."
                                print
                                return 1
                                ;;
                        esac                
                    else
                       length=$(($#-1))
                        P1=${@:1:$length}
                        PROJECT_TYPE=${@: -1}
                        P2=`echo $P1 | awk '{print tolower($0)}'`
                        PROJECT=`echo $P2 | sed 's/ /-/g'`                      
                        case $PROJECT_TYPE in
                            $TAGSPROJECTS)    
                                ;;
                            *)  length=$(($#))
                                P1=${@:1:$length}
                                P2=`echo $P1 | awk '{print tolower($0)}'`
                                PROJECT=`echo $P2 | sed 's/ /-/g'` 
                                PROJECT_TYPE=project
                                ;;
                        esac                      
                    fi
                    case $PROJECT_TYPE in
                        $TAGSPROJECTS)  
                            cp -rf "$RESOURCES/project-types/$PROJECT_TYPE" "$PROJECTS/$PROJECT"
                            tag -a $PROJECT_TYPE "$PROJECTS/$PROJECT" 
                            tag_contexts "$PROJECTS/$PROJECT"
                            ;;
                        *)  printerr "==> Error: Bad project type."
                            print
                            return 1
                            ;;
                    esac
                    cd "$PROJECTS/$PROJECT"
                    open -g . 
                    tag -l "$PROJECTS/$PROJECT"
                    ;;
                    
                jump)
                    shift
                    if [ $# -eq 0 ]; then
                        cd "$PROJECTS"
                    elif [ $# -eq 1 ]; then
                        if [ -e "$PROJECTS/$1" ]; then 
                                cd "$PROJECTS/$1"
                            else
                                printerr "==> Error: Bad argument $1."
                                print
                                return 1  
                            fi
                    else
                        printerr "==> Error: Bad number of arguments."
                        print
                        return 1                     
                    fi
                    ;;
                    
                *)
                    cd "$PROJECTS"
                    open -g .
                    ;;
            esac
            ;;
            
        today)
            shift
            if [ $# -eq 0 ]; then
                cd "$TODAY"
                $TODOTXT list
                open -g .
            elif [ $# -eq 1 ]; then
                case $1 in
                    start)
                        PROJECT=`basename "$PWD"`
                        PROJECTDIR=`find "$PROJECTS" -maxdepth 1 -name "$PROJECT"`
                        if [ -n "$PROJECTDIR" ]; then
                            PROJECTDIR=`find "$TODAY" -maxdepth 1 -lname "$PROJECTS/$PROJECT"`
                            if [ -z "$PROJECTDIR" ]; then 
                                $TODOTXT -t add $(task_name "$PROJECTS/$PROJECT") #due:$(date +"%Y-%M-%d")
                                ln -sf "$PROJECTS/$PROJECT" "$TODAY/$($TODOTXT -@+ list | grep -w "$PROJECT" | head -1)"         
                            fi
                        fi
                        tree -L 1 -Cd -l "$TODAY"
                        $TODOTXT list
                        open -g "$TODAY"
                        ;;
                   
                    stop)
                        PROJECT=`basename "$PWD"`
                        PROJECTDIR=`find "$PROJECTS" -maxdepth 1 -name "$PROJECT"`
                        if [ -n "$PROJECTDIR" ]; then
                            AREADIR=`find "$AREAS" -name "$($TODOTXT -@+ list $PROJECT | head -1)"`
                            if [ -n "$AREADIR" ]; then
                               AREADIRNAME=`dirname "$AREADIR"`
                               AREA=`basename "$AREADIRNAME"`
                               if [ -e "$AREAS/$AREA/$($TODOTXT -@+ list | grep -w "$PROJECT" | head -1)" ]; then 
                                   rm -f "$AREAS/$AREA/$($TODOTXT -@+ list | grep -w "$PROJECT" | head -1)"; 
                               fi
                               if [ -e "$TODAY/$AREA" ]; then
                                  files=($AREAS/$AREA/*)
                                  if [ ${#files[@]} -lt 2 ]; then rm -f "$TODAY/$AREA"; fi
                               fi 
                            fi
                            if [ -L "$TODAY/$($TODOTXT -@+ list | grep -w "$PROJECT" | head -1)" ]; then                               
                                rm -f "$TODAY/$($TODOTXT -@+ list | grep -w "$PROJECT" | head -1)"   
                                TASK=$($TODOTXT list $PROJECT)
                                TASK=$(echo $TASK | grep -o -E '^[0-9]+')
                                $TODOTXT -a do $TASK 
                            fi 

                        fi
                        cd "$TODAY"
                        $TODOTXT list
                        open -g . 
                        ;;
                        
                    startall)
                        DAYOFWEEK=`echo $(date +"%a") | awk '{print tolower($0)}'`
                        cd "$PROJECTS"
                        RESULT=(`tag -m $DAYOFWEEK`)
                        for m in "${RESULT[@]}"
                        do 
                          PROJECT="${m}"
                          if [ ! -e "$TODAY/$PROJECT" ]; then 
                              $TODOTXT -t add $(task_name "$PROJECTS/$PROJECT") #due:$(date +"%Y-%M-%d")
                              ln -sf "$PROJECTS/$PROJECT" "$TODAY/$($TODOTXT -@+ list | grep -w "$PROJECT" | head -1)"
                          fi
                        done
                        cd "$TODAY"
                        $TODOTXT list
                        open -g .                                
                        ;;
                    
                    stopall)
                        find "$TODAY" -type l -delete
                        echo "" > $TODO_DIR/todo.txt
                        cd "$TODAY"
                        $TODOTXT list
                        open -g .                                
                        ;;
                        
                    list)
                        open -g "$TODAY"
                        tree -L 1 -Cd -l "$TODAY"
                        $TODOTXT list
                        ;;
                       
                    jump)
                        cd "$TODAY"
                        ;;
                        
                    archive)
                        find "$TODAY" -type l -delete
                        $TODOTXT archive
                        $TODOTXT -p+@ list > $TODAY/TODOLIST.txt
                        while read line; do 
                            PROJECT=`echo $line | awk '{print  $3}'`
                            if [ ! -e "$TODAY/$PROJECT" ]; then 
                                if [ -e "$PROJECTS/$PROJECT" ]; then 
                                    ln -sf "$PROJECTS/$PROJECT" "$TODAY/$line"
                                fi
                            fi
                        done < $TODAY/TODOLIST.txt
                        rm -f $TODAY/TODOLIST.txt
                        cd "$TODAY"
                        $TODOTXT list
                        open -g .   
                        ;;
                esac 
            elif [ $# -eq 2 ]; then
                case $1 in
                    jump)
                        shift
                        if [ $# -eq 1 ]; then
                            re='^[0-9]+$'
                            if [[ $1 =~ $re ]] ; then
                                cd "$PROJECTS"
                                cd $($TODOTXT list | grep "^$1" | awk {'print $3'})
                            else
                                printerr "==> Error: Bad argument $1."
                                print
                                return 1  
                            fi
                        else
                            printerr "==> Error: Bad number of arguments."
                            print
                            return 1                     
                        fi
                        ;;
                esac                           
            else
                printerr "==> Error: Bad number of arguments."
                print
                return 1
            fi
            ;;
            
        inbox)
            shift
            case $1 in
                list)
                    tree -L 1 -Cd -l "$INBOX"
                    open -g "$INBOX"
                    ;;
                *)
                    cd "$INBOX"
                    open -g .
            esac
            ;;
            
        logbook)
            shift
            case $1 in
                list)
                    tree -L 1 -Cd -l "$LOGBOOK"
                    open -g "$LOGBOOK"
                    ;;
                    
                start)
                    shift                
                    if [ $# -eq 0 ]; then
                        PROJECT=`basename "$PWD"`
                    elif [ $# -eq 1 ]; then
                        PROJECT=$1
                    else
                        printerr "==> Error: Bad number of arguments."
                        print
                        return 1   
                    fi
                    PROJECTDIR=`find "$PROJECTS" -maxdepth 1 -name $PROJECT`
                    if [ -n "$PROJECTDIR" ]; then
                        if [ ! -e "$LOGBOOK/$PROJECT" ]; then 
                            ln -sf "$PWD" "$LOGBOOK/$PROJECT"; 
                            tag -a logbook "$LOGBOOK/$PROJECT"
                        fi
                        DAYOFWEEK=(`tag -lN "$PROJECTS/$PROJECT" | sed 's/,/ /g'`)
                        if [ -e "$SCHEDULED/$PROJECT" ]; then 
                            rm -f "$SCHEDULED/$PROJECT"; 
                        fi
                        for m in "${DAYOFWEEK[@]}"
                        do
                          case $m in
                              mon|tue|wed|thu|fri|weekday)
                                tag -r $m "$PROJECTS/$PROJECT"
                                ;;
                              sat|sun|weekend)
                                tag -r $m "$PROJECTS/$PROJECT"
                                ;;
                              scheduled)
                                tag -r $m "$PROJECTS/$PROJECT"
                                ;;
                          esac 
                        done     
                    else
                        printerr "==> Error: Bad argument $PROJECT."
                        print
                        return 1  
                    fi
                    open -g "$LOGBOOK"
                    ;;
                    
                stop)
                    shift                
                    if [ $# -eq 0 ]; then
                        PROJECT=`basename "$PWD"`
                    elif [ $# -eq 1 ]; then
                        PROJECT=$1
                    else
                        printerr "==> Error: Bad number of arguments."
                        print
                        return 1   
                    fi
                    PROJECTDIR=`find "$PROJECTS" -maxdepth 1 -name $PROJECT`
                    if [ -n "$PROJECTDIR" ]; then
                        if [ -e "$LOGBOOK/$PROJECT" ]; then 
                            tag -r logbook "$LOGBOOK/$PROJECT"
                            rm -f "$LOGBOOK/$PROJECT";   
                        fi 
                    else
                        printerr "==> Error: Bad argument $PROJECT."
                        print
                        return 1  
                    fi
                    open -g "$LOGBOOK"
                    ;;

                *)
                    cd "$LOGBOOK"
                    open -g .
            esac
            ;;
            
        scheduled)
            shift
            case $1 in
                list)
                    tree -L 1 -Cd -l "$SCHEDULED"
                    open -g "$SCHEDULED"
                    ;;
                    
                summary)
                    shift
                    if [ $# -eq 0 ]; then
                        scheduled 
                    elif [ $# -eq 1 ]; then
                        scheduled $1
                    else
                        printerr "==> Error: Bad number of arguments."
                        print
                        return 1        
                    fi
                    ;;
                    
                start)
                    shift         
                    if [ $# -eq 0 ]; then
                        PROJECT=`basename "$PWD"`
                        DAYOFWEEK=(`echo $(date +"%a") | awk '{print tolower($0)}'`)
                    elif [ $# -eq 1 ]; then
                        PROJECTDIR=`find "$PROJECTS" -maxdepth 1 -name $1`
                        if [ -n "$PROJECTDIR" ]; then
                            PROJECT=$1
                            DAYOFWEEK=(`echo $(date +"%a") | awk '{print tolower($0)}'`)
                        else
                            PROJECT=`basename "$PWD"`
                            DAYOFWEEK=(`echo $1 | sed 's/,/ /g'`)
                        fi   
                    elif [ $# -eq 2 ]; then
                        PROJECT=$2
                        DAYOFWEEK=(`echo $1 | sed 's/,/ /g'`)
                    else
                        printerr "==> Error: Bad number of arguments."
                        print
                        return 1   
                    fi                        
                    PROJECTDIR=`find "$PROJECTS" -maxdepth 1 -name $PROJECT`
                    if [ -n "$PROJECTDIR" ]; then
                        if [ ! -e ""$SCHEDULED"/$PROJECT" ]; then 
                            ln -sf "$PWD" "$SCHEDULED/$PROJECT"; 
                        fi
                        for m in "${DAYOFWEEK[@]}"
                        do
                          case $m in
                              mon|tue|wed|thu|fri)
                                tag -a "scheduled,weekday,$m" "$PROJECTS/$PROJECT"
                                ;;
                              sat|sun)
                                tag -a "scheduled,weekend,$m" "$PROJECTS/$PROJECT"
                                ;;
                              *) 
                                printerr "==> Error: Bad day: $m"
                                print
                                return 1   
                                ;;
                          esac 
                        done 
                        if [ -e "$SOMEDAY/$PROJECT" ]; then 
                            tag -r someday "$SOMEDAY/$PROJECT"
                            rm -f "$SOMEDAY/$PROJECT";                              
                        fi  
                        if [ -e "$LOGBOOK/$PROJECT" ]; then 
                            tag -r logbook "$LOGBOOK/$PROJECT"
                            rm -f "$LOGBOOK/$PROJECT";   
                        fi              
                    fi
                    ;;
                    
                stop)
                    shift         
                    if [ $# -eq 0 ]; then
                        PROJECT=`basename "$PWD"`
                        DAYOFWEEK=(`tag -lN "$PROJECTS/$PROJECT" | sed 's/,/ /g'`)
                    elif [ $# -eq 1 ]; then
                        PROJECT=$1
                        DAYOFWEEK=(`tag -lN "$PROJECTS/$PROJECT" | sed 's/,/ /g'`)
                    else
                        printerr "==> Error: Bad number of arguments."
                        print
                        return 1   
                    fi                        
                    PROJECTDIR=`find "$PROJECTS" -maxdepth 1 -name $PROJECT`
                    if [ -n "$PROJECTDIR" ]; then
                        if [ -e "$SCHEDULED/$PROJECT" ]; then 
                            rm -f "$SCHEDULED/$PROJECT"; 
                        fi
                        for m in "${DAYOFWEEK[@]}"
                        do
                          case $m in
                              mon|tue|wed|thu|fri|weekday)
                                tag -r $m "$PROJECTS/$PROJECT"
                                ;;
                              sat|sun|weekend)
                                tag -r $m "$PROJECTS/$PROJECT"
                                ;;
                              scheduled)
                                tag -r $m "$PROJECTS/$PROJECT"
                                ;;
                          esac 
                        done                                               
                    fi
                    ;;
                    
                startall)
                    pushd . &>/dev/null  
                    cd "$PROJECTS"      
                    tag -m scheduled > $PROJECTS/PROJECTS-SCHEDULED.txt
                    while read line; do         
                        ln -sf "$PROJECTS/$line" "$SCHEDULED/$line"
                    done < $PROJECTS/PROJECTS-SCHEDULED.txt
                    rm -f $PROJECTS/PROJECTS-SCHEDULED.txt
                    popd &>/dev/null
                    open -g "$SCHEDULED"                              
                    ;;
                
                stopall)
                    find "$SCHEDULED" -type l -delete
                    open -g "$SCHEDULED"                                
                    ;;
                *)
                    cd "$SCHEDULED"
                    open -g .
            esac
            ;;
            
        someday)
            shift
            case $1 in
                list)
                    tree -L 1 -Cd -l "$SOMEDAY"
                    open -g "$SOMEDAY"
                    ;;
                    
                start)
                    shift         
                    if [ $# -eq 0 ]; then
                        PROJECT=`basename "$PWD"`
                    elif [ $# -eq 1 ]; then
                        PROJECT=$1
                    else
                        printerr "==> Error: Bad number of arguments."
                        print
                        return 1   
                    fi      
                    PROJECTDIR=`find "$PROJECTS" -maxdepth 1 -name $PROJECT`
                    if [ -n "$PROJECTDIR" ]; then
                        if [ ! -e "$SOMEDAY/$PROJECT" ]; then 
                            ln -sf "$PROJECTS/$PROJECT" "$SOMEDAY/$PROJECT"; 
                            tag -a someday "$PROJECTS/$PROJECT"
                        fi
                        if [ -e "$SCHEDULED/$PROJECT" ]; then 
                            rm -f "$SCHEDULED/$PROJECT"; 
                        fi
                        DAYOFWEEK=(`tag -lN "$PROJECTS/$PROJECT" | sed 's/,/ /g'`)
                        for m in "${DAYOFWEEK[@]}"
                        do
                          case $m in
                              mon|tue|wed|thu|fri|weekday)
                                tag -r $m "$PROJECTS/$PROJECT"
                                ;;
                              sat|sun|weekend)
                                tag -r $m "$PROJECTS/$PROJECT"
                                ;;
                              scheduled)
                                tag -r $m "$PROJECTS/$PROJECT"
                                ;;
                          esac 
                        done     
                    fi
                    open -g "$SOMEDAY"
                    ;;
                
                stop)
                    shift         
                    if [ $# -eq 0 ]; then
                        PROJECT=`basename "$PWD"`
                    elif [ $# -eq 1 ]; then
                        PROJECT=$1
                    else
                        printerr "==> Error: Bad number of arguments."
                        print
                        return 1   
                    fi   
                    PROJECTDIR=`find "$PROJECTS" -name $PROJECT`
                    if [ -n "$PROJECTDIR" ]; then
                        if [ -e "$SOMEDAY/$PROJECT" ]; then 
                            tag -r someday "$PROJECTS/$PROJECT"
                            rm -f "$SOMEDAY/$PROJECT";                              
                        fi
                    fi
                    open -g "$SOMEDAY"
                    ;;
                *)
                    cd "$SOMEDAY"
                    open -g .
            esac
            ;;        
 
        git)
            shift
            case $1 in
                start)
                    git init  && \
                    hub create && \ 
                    git add . && \
                    git commit -am "first commit" && \
                    git push origin master && \
                    hub browse .
                    ;;
                    
                stop)
                    shift
                    git add . && \
                    git commit -am "$*" && \
                    git push origin master && \
                    hub browse .
                    ;;
                    
                *)  git status -s
                    ;;                
            esac
            ;;
            
        cloud)
            shift
            case $1 in
                start)
                    if is_Things "$CLOUD"; then
                        print "=> THINGS already to CLOUD."
                        print
                    else
                        print "=> Configuring THINGS to CLOUD..."
                        print 
                        unlink $TODAY_LINK
                        unlink $PROJECTS_LINK
                        ln -sf "$CLOUD/Today" $TODAY_LINK
                        ln -sf "$CLOUD/Projects" $PROJECTS_LINK
                        unlink $THINGS
                        ln -sf "$CLOUD" $THINGS
                        print "-- THINGS  :"
                        ls -l $THINGS
                        print
                    fi
                    ;;
                stop)
                    if is_Things $LOCAL; then
                        print "=> THINGS already to LOCAL."
                        print 
                    else
                        print "=> Configuring THINGS to LOCAL..."
                        print
                        unlink $TODAY_LINK
                        unlink $PROJECTS_LINK
                        ln -sf "$LOCAL/Today" $TODAY_LINK
                        ln -sf "$LOCAL/Projects" $PROJECTS_LINK                     
                        unlink $THINGS
                        ln -sf "$LOCAL" $THINGS
                        print "-- THINGS  :"
                        ls -l $THINGS
                        print 
                    fi
                    ;;
                copy)
                    PROJECT=`basename $PWD`
                    PROJECTDIR=`find $PROJECTS -maxdepth 1 -name $PROJECT`
                    if [ -n "$PROJECTDIR" ]; then
                        if [ ! -e "$CLOUD/Projects/$PROJECT" ]; then 
                            rsync -avErL $PWD "$CLOUD/Projects"
                        fi
                    fi
                    open -g "$CLOUD/Projects/"
                    ;;
                *) 
                    print "=> Listing TODAY configuration..."
                    print 
                    print "-- THINGS  :"
                    if [ ! -L $THINGS ]; then 
                      print "THINGS do not exist."
                      print 
                    else  
                      ls -l $THINGS
                      print 
                    fi
                    ;;
            esac
            ;;
            
        *)
            if [ ! -L "$THINGS" ]; then
                ln -sf "$LOCAL" $THINGS
                ln -sf "$LOCAL/Today" $TODAY_LINK
                ln -sf "$LOCAL/Projects" $PROJECTS_LINK
            fi
            cd "$THINGS"
            open -g .
            ;;
    esac
}
